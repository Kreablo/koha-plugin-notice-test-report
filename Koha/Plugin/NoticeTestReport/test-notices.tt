[% INCLUDE 'doc-head-open.inc' %]
<title>Notice Test Report</title>
[% INCLUDE 'doc-head-close.inc' %]
</head>
<body>
  [% INCLUDE 'intranetstylesheet.inc' %]
  [% INCLUDE 'header.inc' %]
  [% INCLUDE 'cat-search.inc' %]
  [%# INCLUDE 'reports-toolbar.inc' %]
  <div class="row">
    <div class="col-md-2 order-sm-2 order-md-1">
      [% INCLUDE 'reports-menu.inc' %]
    </div>
    <div class="col-md-10 order-md-2 order-sm-1">
      <div id="breadcrumbs"><a href="/cgi-bin/koha/mainpage.pl">Home</a> &rsaquo; <a href="/cgi-bin/koha/plugins/plugins-home.pl">Plugins</a> &rsaquo; Notice Test Report</div>
      [% INCLUDE 'letter_code_selection' %]
      [% IF code_res %]
        [% INCLUDE 'letter_codes' %]
      [% END %]
    </div>
</body>
[% INCLUDE 'intranet-bottom.inc' %]

[%########################################################################################## %]

[% BLOCK 'letter_code_selection' %]
<form method="get">
  <input type="hidden" name="class" value="[% cgi.param('class') %]">
  <input type="hidden" name="method" value="[% cgi.param('method') %]">
  <select name="letter_code">
    [% FOREACH code IN letter_codes %]
      <option
        value="[% code %]"
        [% IF cgi.param("letter_code") == code %]selected[% END %]
      >
        [% code %]
      </option>
    [% END %]
    <input type="submit" value="Submit" >
  </select>
</form>
[% END %] [%# letter_code_selection %]

[% BLOCK 'letter_codes' %]
<div class="result container">
  [% IF code_res.error %]
    <div class="alert alert-danger">
      [% code_res.error %]
    </div>
  [% END %]
  [% IF code_res.ok %]
    <h1>Letter code: [% code_res.ok.letter_code %]</h1>
    [% FOREACH lang_res IN code_res.ok.result %]
      [% INCLUDE 'language_result' %]
    [% END%]
  [% END %]
</div>
[% END %] [%# letter_codes %]

[% BLOCK 'language_result' %]
<h2>Language: [% lang_res.lang %]</h2>
[% FOREACH transport_res IN lang_res.result %]
  [% INCLUDE 'transport_result' %]
[% END %]
[% END %] [%# letter_codes %]

[% BLOCK 'transport_result' %]
<h3>Transport type: [% transport_res.transport %]</h3>
[% IF transport_res.error %]
  <div class="alert alert-danger">
    [% transport_res.error %]
  </div>
[% END %]
[% IF transport_res.result.warning %]
  <div class="alert alert-warning">
    <p>WARNING: [% transport_res.result.warning %]</p>
  </div>
[% END %]
[% IF transport_res.result.ok %]
  <div class="row">
    <div class="col-6">
      <h4>Html</h4>
      <pre class="resulting-letter">
        [% transport_res.result.ok.content | html %]
      </pre>
    </div>
    <div class="col-6">
      <h4>Preview</h4>
      <iframe
        width="100%"
        height="100%"
        style="border-left: 1px dashed gray;"
        srcdoc="[% transport_res.result.wrapped | html %]"
      >
      </iframe>
    </div>
  </div>
[% END %]
[% END %] [%# transport_types %]
